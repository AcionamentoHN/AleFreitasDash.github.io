<!DOCTYPE html>
<html>
<head>
    <title>Exemplo de distância entre cidades</title>
    <!-- Inclui o Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Inclui o jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Inclui o Bing Maps SDK -->
    <script type="text/javascript" src="https://www.bing.com/api/maps/mapcontrol?callback=loadMapScenario&key=YOUR_BING_MAPS_KEY" async defer></script>
</head>
<body>
    <div class="container">
        <h1>Exemplo de distância entre cidades</h1>
        <p>Escolha duas cidades e veja a distância entre elas.</p>
        <form id="form-cidades">
            <!-- ... (seu formulário e campos) ... -->
        </form>
        <div id="resultado" class="alert alert-success" style="display: none;"></div>
        <!-- Div onde o mapa será mostrado -->
        <div id="mapa" style="width: 800px; height: 600px;"></div>
    </div>

    <!-- Script para carregar o mapa e calcular a distância -->
    <script>
        var bingMapsKey = "AlqUFiLlbuRfALG8dH9Tca8eA2fnacLq9VX1ic8n29op_INF1sKPZbb3BAE5jZhs";
        var googleSheetsKey = "AIzaSyAxGbdWe639fXoxSAnogiMC_sJBFn5uXsk";
        var googleSheetsId = "1I4GB6KQVa_6254wcguR4BzG8FQn96slmWy0usPmxW5k";
        var googleSheetsTab = "KM";

        function loadMapScenario() {
            var mapa = new Microsoft.Maps.Map(document.getElementById("mapa"), {
                credentials: bingMapsKey
            });

            var directionsManager = new Microsoft.Maps.Directions.DirectionsManager(mapa);

            $("#form-cidades").submit(function(event) {
                event.preventDefault();

                var origem = $("#cidade-origem").val();
                var destino = $("#cidade-destino").val();

                var request = {
                    travelMode: Microsoft.Maps.Directions.TravelMode.driving,
                    origin: new Microsoft.Maps.Location(origem.split(",")[0], origem.split(",")[1]),
                    destination: new Microsoft.Maps.Location(destino.split(",")[0], destino.split(",")[1])
                };

                directionsManager.clearAll();
                directionsManager.addWaypoint(request.origin);
                directionsManager.addWaypoint(request.destination);
                directionsManager.setRenderOptions({
                    itineraryContainer: document.getElementById("resultado")
                });

                directionsManager.calculateDirections();

                var distancia = directionsManager.getCurrentRoute().routeLegs[0].summary.distance;

                $("#resultado").html("A distância entre as cidades é de " + distancia + " km.");
                $("#resultado").show();

                var dados = {
                    values: [
                        [origem, destino, distancia]
                    ]
                };

                $.ajax({
                    url: "https://sheets.googleapis.com/v4/spreadsheets/" + googleSheetsId + "/values/" + googleSheetsTab + ":append?valueInputOption=USER_ENTERED&key=" + googleSheetsKey,
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(dados),
                    success: function(response) {
                        alert("Planilha atualizada com sucesso!");
                    },
                    error: function(error) {
                        alert("Erro ao atualizar a planilha: " + error.responseText);
                    }
                });
            });
        }
    </script>
</body>
</html>
